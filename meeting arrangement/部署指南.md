# 家长预约系统部署指南

## 文件夹说明

### 前端 - `pages/` 文件夹
部署到腾讯云 EdgeOne Pages

**包含文件：**
- `index.html` - 家长登录页面
- `parent_dashboard.html` - 家长预约仪表盘（已添加会议类型显示功能）
- `logo.png` - Logo 图片

### 后端 - `CFunction/` 文件夹
部署到腾讯云函数 SCF

**包含文件：**
- `scf_index.js` - 云函数入口文件
- `package.json` - 依赖配置
- `scf_bootstrap` - 启动脚本
- `node_modules/` - 依赖包（已安装）

---

## 部署步骤

### 第一步：部署后端到腾讯云函数

1. **登录腾讯云控制台** → 云函数

2. **新建函数**：
   - 函数名称：`meeting-booking-parent`
   - 运行环境：Node.js 16.x/18.x
   - 函数类型：**Web 函数**

3. **上传代码**：
   - 选择「文件夹上传」
   - 上传 `CFunction` 整个文件夹
   - 或打包为 zip 后上传

4. **配置环境变量**（在「配置」→「环境变量」中）：
   ```
   MONGO_URI=mongodb://49.235.189.246:27017
   DB_NAME=GHS
   GHA_DB_NAME=GHA
   PORT=9000
   ```

5. **获取函数访问地址**：
   - 在「触发管理」→「访问路径」中复制 URL
   - 格式类似：`https://xxx-xxx.ap-shanghai.tencentscf.com`

---

### 第二步：部署前端到 EdgeOne Pages

1. **登录 EdgeOne 控制台**

2. **创建站点**：
   - 站点名称：`meeting-booking-parent`
   - 站点类型：静态网站

3. **上传文件**：
   - 将 `pages` 文件夹中的所有文件上传
   - 确保包含：`index.html`、`parent_dashboard.html`、`logo.png`

4. **配置 API 地址**：
   - 下载 `parent_dashboard.html`
   - 找到第 1227 行：
   ```javascript
   const API_BASE_URL = 'https://1300190563-2hqncjntw.ap-shanghai.tencentscf.com';
   ```
   - 修改为你的云函数 URL

5. **重新上传修改后的文件**

---

## 验证部署

### 测试后端 API
```bash
# 测试 API 是否正常
curl https://your-function-url/api/test

# 预期返回：
# {"success":true,"message":"API 测试成功","time":"..."}
```

### 测试前端
1. 访问 EdgeOne Pages 提供的网站地址
2. 输入家长手机号登录
3. 尝试搜索学生、选择教师、预约时段

---

## 功能特性

### 最新更新（2025-02-09）
✅ 会议类型标识
- 时段卡片显示"腾讯会议"或"线下"标签
- 预约列表智能显示会议信息
- 绿色表示线上会议，橙色表示线下会议

✅ 冲突检测
- 同教师同一天只能预约一次
- 时间冲突自动检测
- 前后端双重验证

---

## 注意事项

1. **环境变量**：确保云函数配置了正确的 MongoDB 连接
2. **API 地址**：前端 `API_BASE_URL` 必须与云函数地址一致
3. **CORS**：已配置允许所有来源访问
4. **数据库**：使用 GHS（会议）和 GHA（学生）两个数据库

---

## 快速参考

| 用途 | 文件/路径 |
|------|----------|
| 前端上传 | `pages/` 文件夹 |
| 后端上传 | `CFunction/` 文件夹 |
| API 配置 | `parent_dashboard.html` 第 1227 行 |
| 环境变量 | 云函数控制台配置 |
